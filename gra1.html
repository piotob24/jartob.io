<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Gra 1 â€“ ZwierzÄ™ta (SpostrzegawczoÅ›Ä‡)</title>
  <style>
    body { font-family: Arial, sans-serif; text-align: center; background:#f1f2f6; margin:0; padding:20px; }
    h1 { color:#0a3d62; margin-top:0; }
    .controls { margin: 10px 0 15px; display:flex; gap:12px; justify-content:center; align-items:center; flex-wrap:wrap; }
    .btn {
      padding:10px 18px; border:none; border-radius:10px; background:#0a3d62; color:#fff; cursor:pointer;
      font-weight:bold; transition:transform .15s ease, opacity .15s ease;
    }
    .btn:disabled { opacity:.5; cursor:not-allowed; }
    .info { font-size:18px; }
    .animals { display:flex; justify-content:center; gap:20px; margin:20px auto; flex-wrap:wrap; max-width:900px; }
    .animals button { border:none; background:none; cursor:pointer; transition: transform .15s ease; }
    .animals button:focus { outline: 3px solid #ffcc00; border-radius:12px; }
    .animals button:hover { transform: scale(1.05); }
    .animals img { width:160px; height:160px; border:3px solid #ccc; border-radius:12px; object-fit:cover; background:#fff; }
    .highlight { border-color:#ffcc00 !important; box-shadow:0 0 0 4px rgba(255,204,0,.35); }
    .msg { min-height: 28px; color:#333; margin-top:10px; }
  </style>
</head>
<body>
  <h1>Gra 1 â€“ SpostrzegawczoÅ›Ä‡</h1>
  <p>Klikaj zwierzÄ™ta w tej samej kolejnoÅ›ci, w jakiej siÄ™ podÅ›wietlajÄ… ğŸ®ğŸ¶ğŸ±</p>

  <div class="controls">
    <button id="startBtn" class="btn" onclick="startGame()">Start</button>
    <span class="info">Punkty: <strong id="score">0</strong></span>
    <span class="info">Rekord: <strong id="highscore">0</strong></span>
    <span class="info">Poziom: <strong id="level">1</strong></span>
  </div>

  <div class="animals">
    <button aria-label="Krowa" onclick="selectAnimal('cow')">
      <img id="img-cow" src="media/cow.png" alt="Krowa">
    </button>
    <button aria-label="Pies" onclick="selectAnimal('dog')">
      <img id="img-dog" src="media/dog.png" alt="Pies">
    </button>
    <button aria-label="Kot" onclick="selectAnimal('cat')">
      <img id="img-cat" src="media/kitty.png" alt="Kot">
    </button>
  </div>

  <!-- DÅºwiÄ™ki â€“ podmieÅ„ na wÅ‚asne pliki w folderze media/ -->
  <audio id="cow-sound" src="media/cow.mp3" preload="auto"></audio>
  <audio id="dog-sound" src="media/dog.mp3" preload="auto"></audio>
  <audio id="cat-sound" src="media/cat.mp3" preload="auto"></audio>

  <div id="message" class="msg"></div>

  <script>
    const scoreEl = document.getElementById('score');
    const levelEl = document.getElementById('level');
    const hsEl = document.getElementById('highscore');
    const startBtn = document.getElementById('startBtn');
    const messageEl = document.getElementById('message');

    const animals = ['cow','dog','cat'];
    let sequence = [];
    let player = [];
    let score = 0;
    let level = 1;
    let isPlayingSequence = false;

    // wczytaj rekord
    let highscore = parseInt(localStorage.getItem('animalSimonHS') || '0', 10);
    hsEl.textContent = highscore;

    function resetState() {
      sequence = [];
      player = [];
      score = 0;
      level = 1;
      scoreEl.textContent = score;
      levelEl.textContent = level;
      messageEl.textContent = '';
    }

    function startGame() {
      resetState();
      nextRound();
    }

    function nextRound() {
      player = [];
      sequence.push(randomAnimal());
      level = sequence.length;
      levelEl.textContent = level;
      playSequence();
    }

    function randomAnimal() {
      return animals[Math.floor(Math.random() * animals.length)];
    }

    function getImg(animal) {
      return document.getElementById('img-' + animal);
    }

    function getSound(animal) {
      return document.getElementById(animal + '-sound');
    }

    function wait(ms) {
      return new Promise(res => setTimeout(res, ms));
    }

    // od 5 poziomu sekwencja przyspiesza
    function currentFlashDuration() {
      const base = 800; // ms
      if (level >= 9) return 450;
      if (level >= 7) return 550;
      if (level >= 5) return 650;
      return base;
    }

    async function flash(animal, duration) {
      const img = getImg(animal);
      const audio = getSound(animal);
      if (!img || !audio) return;

      img.classList.add('highlight');
      // play moÅ¼e rzuciÄ‡ obietnicÄ™ odrzuconÄ… â€“ Å‚apiemy, by nie przerywaÄ‡ sekwencji
      try { await audio.play(); } catch(e) {}
      await wait(duration);
      img.classList.remove('highlight');
      await wait(220);
    }

    async function playSequence() {
      isPlayingSequence = true;
      startBtn.disabled = true;
      messageEl.textContent = 'Patrz i sÅ‚uchajâ€¦';
      const dur = currentFlashDuration();
      for (const a of sequence) {
        await flash(a, dur);
      }
      isPlayingSequence = false;
      startBtn.disabled = false;
      messageEl.textContent = 'Twoja kolej! Klikaj w tej samej kolejnoÅ›ci.';
    }

    function selectAnimal(animal) {
      if (isPlayingSequence || sequence.length === 0) return; // ignoruj klikniÄ™cia podczas odtwarzania

      // dÅºwiÄ™k takÅ¼e przy klikniÄ™ciu gracza
      const s = getSound(animal);
      if (s) { try { s.currentTime = 0; s.play(); } catch(e) {} }

      player.push(animal);

      // sprawdzenie bieÅ¼Ä…cego kroku
      const idx = player.length - 1;
      if (player[idx] !== sequence[idx]) {
        // poraÅ¼ka
        messageEl.textContent = 'âŒ SprÃ³buj ponownie! Punkty wyzerowane.';
        if (score > highscore) {
          highscore = score;
          localStorage.setItem('animalSimonHS', String(highscore));
          hsEl.textContent = highscore;
        }
        score = 0;
        scoreEl.textContent = score;
        // reset sekwencji â€“ nowa gra po klikniÄ™ciu Start
        sequence = [];
        player = [];
        return;
      }

      // jeÅ›li do tej pory ok, a gracz skoÅ„czyÅ‚ caÅ‚Ä… sekwencjÄ™
      if (player.length === sequence.length) {
        score++;
        scoreEl.textContent = score;
        messageEl.textContent = 'âœ… Super! Nowa runda za chwilÄ™â€¦';
        setTimeout(nextRound, 700);
      }
    }
  </script>
</body>
</html>
